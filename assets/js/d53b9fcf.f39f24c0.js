"use strict";(self.webpackChunkcodepainter=self.webpackChunkcodepainter||[]).push([[175],{90954:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>t,metadata:()=>c,toc:()=>a});var i=s(74848),l=s(28453);const t={title:"php\u534f\u7a0b\u7b14\u8bb0",comments:!1,date:new Date("2019-12-07T18:19:13.000Z"),tags:["php","\u534f\u7a0b"],categories:"php",cover:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191216194707.png",slug:"/pages/8b9904/"},r=void 0,c={id:"\u6280\u672f\u7b14\u8bb0/\u540e\u7aef/PHP/php\u534f\u7a0b\u7b14\u8bb0",title:"php\u534f\u7a0b\u7b14\u8bb0",description:"\u524d\u8a00",source:"@site/docs/01.\u6280\u672f\u7b14\u8bb0/02.\u540e\u7aef/03.PHP/03.php\u534f\u7a0b\u7b14\u8bb0.md",sourceDirName:"01.\u6280\u672f\u7b14\u8bb0/02.\u540e\u7aef/03.PHP",slug:"/pages/8b9904/",permalink:"/docs/pages/8b9904/",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/01.\u6280\u672f\u7b14\u8bb0/02.\u540e\u7aef/03.PHP/03.php\u534f\u7a0b\u7b14\u8bb0.md",tags:[{label:"php",permalink:"/docs/tags/php"},{label:"\u534f\u7a0b",permalink:"/docs/tags/\u534f\u7a0b"}],version:"current",sidebarPosition:3,frontMatter:{title:"php\u534f\u7a0b\u7b14\u8bb0",comments:!1,date:"2019-12-07T18:19:13.000Z",tags:["php","\u534f\u7a0b"],categories:"php",cover:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191216194707.png",slug:"/pages/8b9904/"},sidebar:"techwiki",previous:{title:"PHP+phpstorm+xdebug \u73af\u5883\u914d\u7f6e",permalink:"/docs/pages/e25214/"},next:{title:"Python\u88c5\u9970\u5668\uff1a\u5c06\u88c5\u9970\u5668\u5b9a\u4e49\u4e3a\u7c7b",permalink:"/docs/pages/a583c4/"}},d={},a=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u8fdb\u7a0b\u3001\u7ebf\u7a0b\u3001\u534f\u7a0b\u7684\u533a\u522b",id:"\u8fdb\u7a0b\u7ebf\u7a0b\u534f\u7a0b\u7684\u533a\u522b",level:2},{value:"\u8fdb\u7a0b",id:"\u8fdb\u7a0b",level:3},{value:"\u7ebf\u7a0b",id:"\u7ebf\u7a0b",level:3},{value:"\u534f\u7a0b",id:"\u534f\u7a0b",level:3},{value:"\u8fed\u4ee3\u751f\u6210\u5668",id:"\u8fed\u4ee3\u751f\u6210\u5668",level:2},{value:"\u534f\u7a0b",id:"\u534f\u7a0b-1",level:2},{value:"send \u51fd\u6570",id:"send-\u51fd\u6570",level:3},{value:"yield \u4f5c\u4e3a\u53c2\u6570\u63a5\u53d7\u8005",id:"yield-\u4f5c\u4e3a\u53c2\u6570\u63a5\u53d7\u8005",level:3},{value:"yield \u540c\u65f6\u63a5\u53d7\u548c\u53d1\u9001\u6570\u636e",id:"yield-\u540c\u65f6\u63a5\u53d7\u548c\u53d1\u9001\u6570\u636e",level:3},{value:"\u591a\u4efb\u52a1\u5408\u4f5c",id:"\u591a\u4efb\u52a1\u5408\u4f5c",level:3},{value:"\u4efb\u52a1",id:"\u4efb\u52a1",level:4},{value:"\u8fed\u4ee3\u5668",id:"\u8fed\u4ee3\u5668",level:4},{value:"\u4e0e\u8c03\u5ea6\u5668\u4e4b\u95f4\u7684\u901a\u4fe1",id:"\u4e0e\u8c03\u5ea6\u5668\u4e4b\u95f4\u7684\u901a\u4fe1",level:4},{value:"\u534f\u7a0b\u5806\u6808",id:"\u534f\u7a0b\u5806\u6808",level:2},{value:"\u534f\u7a0b\u5806\u6808\u5c0f\u7ed3",id:"\u534f\u7a0b\u5806\u6808\u5c0f\u7ed3",level:3},{value:"\u7a0b\u5e8f\u9644\u5f55",id:"\u7a0b\u5e8f\u9644\u5f55",level:2},{value:"\u7a0b\u5e8f\u4e00\uff1a \u4e0e\u8c03\u5ea6\u5668\u4e4b\u95f4\u7684\u901a\u8baf",id:"\u7a0b\u5e8f\u4e00-\u4e0e\u8c03\u5ea6\u5668\u4e4b\u95f4\u7684\u901a\u8baf",level:3},{value:"\u7a0b\u5e8f\u4e8c\uff1a \u534f\u7a0b\u5806\u6808",id:"\u7a0b\u5e8f\u4e8c-\u534f\u7a0b\u5806\u6808",level:3}];function h(n){const e={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"\u524d\u8a00",children:"\u524d\u8a00"}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u5b9e\u4e60\u7684\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u5230\u4e86\u817e\u8baf\u5fae\u670d\u52a1\u5e73\u53f0\uff08Tencent Service Framework\uff0cTSF\uff09\u6846\u67b6\uff0ctsf\u4e2d\u7ecf\u5e38\u770b\u5230"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.code,{children:"$ret = (yield func(a,b));"})}),"\n",(0,i.jsxs)(e.p,{children:["\u8fd9\u6837\u7684\u7528\u6cd5\u3002\nyield \u5916\u9762\u5305\u62ec\u53f7\u7684\u7528\u6cd5\u5e76\u4e0d\u5e38\u89c1\uff0c\u5b9e\u9645\u4e0a\u8fd9\u662fyield\u7684\u4e00\u79cd\u7279\u6b8a\u7684\u7528\u6cd5\u2014\u2014",(0,i.jsx)(e.em,{children:(0,i.jsx)(e.strong,{children:"\u534f\u7a0b"})}),"\u3002\n\u8fd9\u91cc\u6211\u51c6\u5907\u901a\u8bfb\u4e00\u4e0b\u8fd9\u4e00\u9886\u57df\u7684\u7ecf\u5178\u6559\u7a0b\uff0c\u597d\u597d\u7406\u89e3yield \u548c \u534f\u7a0b \u662f\u5982\u4f55\u5728PHP \u9879\u76ee\u5f00\u53d1\u4e2d\u8d77\u5230\u4f5c\u7528\u7684\u3002"]}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"http://www.laruence.com/2015/05/28/3038.html",children:"\u5728PHP\u4e2d\u4f7f\u7528\u534f\u7a0b\u5b9e\u73b0\u591a\u4efb\u52a1\u8c03\u5ea6| \u98ce\u96ea\u4e4b\u9685"})}),"\n",(0,i.jsx)(e.p,{children:"\u4f5c\u8005\u80cc\u666f\uff1a\u98ce\u96ea\u4e4b\u9685\uff0cPHP\u5f00\u53d1\u7ec4\u6838\u5fc3\u6210\u5458\uff0c\u9e1f\u53d4\uff0cPHP7\u7684\u4e3b\u8981\u5f00\u53d1\u8005\u3002\u672c\u7bc7\u6587\u7ae0\u5176\u5b9e\u4ed6\u5bf9\u4e00\u7bc7\u82f1\u6587\u6559\u7a0b\u7684\u7ffb\u8bd1\u4e4b\u4f5c\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u4e4b\u6240\u4ee5\u6807\u9898\u8d77\u7b14\u8bb0\uff0c\u539f\u56e0\u662f\u539f\u6587\u7406\u89e3\u8d77\u6765\u7a0d\u6709\u96be\u5ea6\uff0c\u6240\u4ee5\u6211\u8fd9\u91cc\u52a0\u4e0a\u81ea\u5df1\u7684\u7406\u89e3\u3002\u672c\u7bc7\u53ef\u4ee5\u5728\u5927\u5bb6\u8bfb\u539f\u6587\u7684\u8fc7\u7a0b\u4e2d\u505a\u4e00\u4e2a\u53c2\u8003\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"\u8fdb\u7a0b\u7ebf\u7a0b\u534f\u7a0b\u7684\u533a\u522b",children:"\u8fdb\u7a0b\u3001\u7ebf\u7a0b\u3001\u534f\u7a0b\u7684\u533a\u522b"}),"\n",(0,i.jsx)(e.h3,{id:"\u8fdb\u7a0b",children:"\u8fdb\u7a0b"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fdb\u7a0b\u662f\u7a0b\u5e8f\u6267\u884c\u7684\u4e00\u4e2a\u5b9e\u4f8b"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fdb\u7a0b\u662f\u8d44\u6e90\u5206\u914d\u7684\u6700\u5c0f\u5355\u4f4d\uff0c\u8d44\u6e90\u5305\u62ec\uff1aCPU\uff0c\u5185\u5b58\uff0cI/O\u7b49"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["\u8fdb\u7a0b\u95f4\u7684\u901a\u8baf\u65b9\u5f0f\uff08IPC\uff09 <---- \u6284\uff0c\u53c2\u8003",(0,i.jsx)(e.a,{href:"https://blog.csdn.net/daaikuaichuan/article/details/82951084",children:"https://blog.csdn.net/daaikuaichuan/article/details/82951084"})]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7ba1\u9053 Pipe"}),"\n",(0,i.jsx)(e.li,{children:"\u547d\u540d\u7ba1\u9053 FIFO"}),"\n",(0,i.jsxs)(e.li,{children:["* \u6d88\u606f\u961f\u5217\uff08Message Queue)\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u817e\u8baf\u7684hippo"}),"\n",(0,i.jsx)(e.li,{children:"Kafka"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.li,{children:"\u4fe1\u53f7\u91cf\uff08Semaphore\uff09"}),"\n",(0,i.jsx)(e.li,{children:"\u5171\u4eab\u5185\u5b58\uff08Shared Memory\uff09"}),"\n",(0,i.jsx)(e.li,{children:"* \u5957\u63a5\u5b57\uff08Socket\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u7ebf\u7a0b",children:"\u7ebf\u7a0b"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u8f7b\u91cf\u7ea7\u8fdb\u7a0b(Lightweight Process\uff0cLWP\uff09"})}),"\n",(0,i.jsx)(e.li,{children:"CPU\u8c03\u5ea6\u7684\u6700\u5c0f\u5355\u4f4d"}),"\n",(0,i.jsx)(e.li,{children:"\u8fdb\u7a0b\u7531\u4e8e\u662f\u62e5\u6709\u7cfb\u7edf\u8d44\u6e90\uff0c\u6240\u4ee5\u5207\u6362\u65f6\u9700\u8981\u4fdd\u5b58\u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u5f00\u9500\u5927\u3002\u7ebf\u7a0b\u5f00\u9500\u5c0f"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u534f\u7a0b",children:"\u534f\u7a0b"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u534f\u7a0b\u662f\u4e00\u79cd\u6bd4\u7ebf\u7a0b\u66f4\u52a0\u8f7b\u91cf\u7ea7\u7684\u5b58\u5728"}),"\n",(0,i.jsx)(e.li,{children:"\u4e0e\u8fdb\u7a0b\u7ebf\u7a0b\u4e0d\u540c\u7684\u662f\uff0c\u534f\u7a0b\u662f\u5b8c\u5168\u7531\u7a0b\u5e8f\u63a7\u5236\u5728\uff08\u7528\u6237\u6001\u6267\u884c\uff09"}),"\n",(0,i.jsx)(e.li,{children:"\u4e3e\u4f8b\uff1a \u5f53\u6211\u4eec\u8bfb\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3b\u52a8\u8ba9\u51fa\u63a7\u5236\u6743\uff0c\u800c\u4e0d\u662f\u7b49\u5f85I/O\u64cd\u4f5c\u5b8c\u6210\u3002"}),"\n",(0,i.jsxs)(e.li,{children:["\u7279\u70b9\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6781\u9ad8\u7684\u6267\u884c\u6548\u7387\uff0c\u6ca1\u6709\u7ebf\u7a0b\u90a3\u4e48\u5927\u7684\u5207\u6362\u5f00\u9500\u3002\n\u6211\u4eec\u77e5\u9053\u6d89\u53ca\u5230\u5185\u6838\u53c2\u4e0e\u7ba1\u7406\u7684\u7a0b\u5e8f\uff0c\u9700\u8981\u4ece\u7528\u6237\u6001\u901a\u8fc7\u4e2d\u65ad\u7684\u65b9\u5f0f\u5207\u6362\u5230\u5185\u6838\u6001\u3002\u8fd9\u6837\u7684\u5f00\u9500\u662f\u6781\u5927\u7684\u3002"}),"\n",(0,i.jsxs)(e.li,{children:["\u4e0d\u9700\u8981\u591a\u7ebf\u7a0b\u7684\u9501\u673a\u5236\uff0c",(0,i.jsx)(e.strong,{children:"\u5728\u534f\u7a0b\u4e2d\u63a7\u5236\u5171\u4eab\u8d44\u6e90\u4e0d\u52a0\u9501"})]}),"\n",(0,i.jsx)(e.li,{children:"\u5bf9\u7528\u6237\u53ef\u89c1"}),"\n",(0,i.jsx)(e.li,{children:"\u534f\u540c\uff0c\u56e0\u4e3a\u662f\u7531\u7a0b\u5e8f\u5458\u81ea\u5df1\u5199\u7684\u8c03\u5ea6\u7b56\u7565\uff0c\u5176\u901a\u8fc7\u534f\u4f5c\u800c\u4e0d\u662f\u62a2\u5360\u6765\u8fdb\u884c\u5207\u6362"}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u534f\u7a0b\u7684\u601d\u60f3\u672c\u8d28\u4e0a\u5c31\u662f\u63a7\u5236\u6d41\u7684\u4e3b\u52a8\u8ba9\u51fa\uff08yield\uff09\u548c\u6062\u590d\uff08resume\uff09\u673a\u5236"}),"\uff08\u6765\u6e90\uff1a",(0,i.jsx)(e.a,{href:"https://segmentfault.com/a/1190000012457145",children:"PHP7\u4e0b\u7684\u534f\u7a0b\u5b9e\u73b0"}),"\uff09"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u8fed\u4ee3\u751f\u6210\u5668",children:"\u8fed\u4ee3\u751f\u6210\u5668"}),"\n",(0,i.jsx)(e.p,{children:"\u8fed\u4ee3\u751f\u6210\u5668\u662f\u6211\u4eec\u5bf9\u4e8e yield \u6700\u5e38\u7528\u7684\u4e00\u4e2a\u529f\u80fd\u3002\n\u7528 yield \u66ff\u4ee3 return \u4f5c\u4e3a\u51fd\u6570\u7684\u8fd4\u56de\u6700\u5927\u7684\u4f5c\u7528\u662f\uff0c\u5b83\u8fd4\u56de\u7684\u4e0d\u4ec5\u662f\u4e00\u4e2a\u503c\uff0c\u800c\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668\u3002\u8fd9\u4e00\u4f18\u70b9\u5728\u9762\u5bf9\u65e0\u6cd5\u8f7d\u5165\u5230\u5185\u5b58\u7684\u5927\u578b\u6570\u636e\u96c6\u6709\u5f88\u5927\u7684\u4f5c\u7528\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u4ee5\u4e0b\u4ee3\u7801"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'function xrange($start,$end,$step = 1){\n\tfor ($i = $start ; $i <= $end ; $i += $step){\n\t\tyield $i;\n\t}\n}\n\nforeach (xrange(1,10000000000) as $num) {\n\techo $num ."<br>";\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u5f88\u660e\u663e\uff0c\u8fd9\u91cc\u4f7f\u7528return\u7684\u8bdd\uff0c\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u6570\u7ec4\uff0c\u5f53\u4f60\u6570\u636e\u91cf\u7279\u522b\u5927\u7684\u65f6\u5019\u4f1a\u9020\u6210\u6570\u636e\u6ea2\u51fa\u7684\u95ee\u9898\u3002\nyield \u7684\u795e\u5947\u4e4b\u5904\u5728\u4e8e\uff0c\u5b83\u4f1a\u4fdd\u6301\u751f\u6210\u5668\u7684\u72b6\u6001\u3002\u51fd\u6570\u4f1a\u4e00\u76f4\u8fd0\u884c\uff0c\u76f4\u5230\u4e0b\u4e00\u4e2ayield\u3002\u7a0b\u5e8f\u6267\u884c\u7684\u63a7\u5236\u6d41\u53ef\u4ee5\u5728\u4e3b\u4ee3\u7801\u548c\u751f\u6210\u5668\u51fd\u6570\u4e4b\u95f4\u5207\u6362\uff0c\u4e5f\u4e0d\u7528\u7528\u6237\u62c5\u5fc3\u4e0a\u4e0b\u6587\u73af\u5883\u7684\u95ee\u9898\u3002\n\u4f18\u70b9"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8fd0\u884c\u5927\u578b\u6570\u636e\u96c6"}),"\n",(0,i.jsx)(e.li,{children:"\u4e0d\u7528\u7f16\u5199\u5c31\u80fd\u751f\u6210\u590d\u6742\u7684\u751f\u6210\u5668"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u5199\u4e00\u4e2a\u751f\u6210\u5668\u7684\u6d41\u7a0b\uff0c\u9700\u8981"}),"\n",(0,i.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(e.li,{children:["\u88ab\u8fed\u4ee3\u7684\u7c7b\u5b9e\u73b0 IteratorAggregate ",(0,i.jsx)(e.strong,{children:"\u63a5\u53e3"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u5b9a\u4e49\u4e00\u4e2a\u8fd4\u56de\u8fed\u4ee3\u7c7b\u7684\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u7c7b\u5fc5\u987b\u5b9e\u73b0Iterator ",(0,i.jsx)(e.strong,{children:"\u63a5\u53e3"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u63d0\u4f9b\u4e00\u7cfb\u5217\u5fc5\u987b\u5b9e\u73b0\u7684\u65b9\u6cd5\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"rewind : \u51fd\u6570\u5185\u90e8\u6307\u9488\u8bbe\u7f6e\u56de\u5230\u6570\u636e\u5f00\u59cb\u5904"}),"\n",(0,i.jsx)(e.li,{children:"valid : \u5224\u8bfb\u662f\u5426\u8fd8\u6709\u6570\u636e"}),"\n",(0,i.jsx)(e.li,{children:"key : \u8fd4\u56de\u6570\u636e\u6307\u9488\u503c"}),"\n",(0,i.jsx)(e.li,{children:"current : \u8fd4\u56de\u5f53\u524d\u6307\u9488\u6307\u5411\u7684\u503c"}),"\n",(0,i.jsx)(e.li,{children:"next : \u79fb\u52a8\u5230\u4e0b\u4e00\u4f4d\nyield \u5173\u952e\u5b57\u7b80\u5316\u4e86\u5b9e\u73b0\u8fed\u4ee3\u5668\u7684\u8fc7\u7a0b\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{className:"task-list-item",children:[(0,i.jsx)(e.input,{type:"checkbox",disabled:!0})," TODO \u5b9e\u73b0\u4e00\u4e2aPHP Iterator \u5bf9\u8c61"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u534f\u7a0b-1",children:"\u534f\u7a0b"}),"\n",(0,i.jsx)(e.p,{children:"yield \u7684\u4e00\u4e2a\u7279\u6027\u662f\u51fd\u6570\u6bcf\u6b21\u6267\u884c\u5230yield \u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u4e3b\u52a8\u8ba9\u51fa\u63a7\u5236\u6743\u3002\u8fd9\u4e00\u70b9\u53ef\u4ee5\u5f88\u597d\u7684\u5e2e\u52a9\u6211\u4eec\u63a7\u5236\u7a0b\u5e8f\u7684\u6267\u884c\u987a\u5e8f\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"send-\u51fd\u6570",children:"send \u51fd\u6570"}),"\n",(0,i.jsxs)(e.p,{children:["public Generator::send ( ",(0,i.jsx)(e.a,{href:"https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed",children:"mixed"})," ",(0,i.jsx)(e.code,{children:"$value"})," ) : ",(0,i.jsx)(e.a,{href:"https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed",children:"mixed"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u5411\u751f\u6210\u5668\u4e2d\u4f20\u5165\u4e00\u4e2a\u503c\uff0c\u5e76\u4e14\u5f53\u505a ",(0,i.jsx)(e.a,{href:"https://www.php.net/manual/zh/language.generators.syntax.php#control-structures.yield",children:"yield"})," \u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.em,{children:(0,i.jsx)(e.strong,{children:"\u7136\u540e\u7ee7\u7eed\u6267\u884c\u751f\u6210\u5668"})}),"\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u5982\u679c\u5f53\u8fd9\u4e2a\u65b9\u6cd5\u88ab\u8c03\u7528\u65f6\uff0c\u751f\u6210\u5668\u4e0d\u5728 ",(0,i.jsx)(e.a,{href:"https://www.php.net/manual/zh/language.generators.syntax.php#control-structures.yield",children:"yield"})," \u8868\u8fbe\u5f0f\uff0c\u90a3\u4e48\u5728\u4f20\u5165\u503c\u4e4b\u524d\uff0c\u5b83\u4f1a\u5148\u8fd0\u884c\u5230\u7b2c\u4e00\u4e2a ",(0,i.jsx)(e.a,{href:"https://www.php.net/manual/zh/language.generators.syntax.php#control-structures.yield",children:"yield"})," \u8868\u8fbe\u5f0f\u3002\u4f20\u5165\u751f\u6210\u5668\u7684\u503c\u3002\u8fd9\u4e2a\u503c\u5c06\u4f1a\u88ab\u4f5c\u4e3a\u751f\u6210\u5668\u5f53\u524d\u6240\u5728\u7684 ",(0,i.jsx)(e.a,{href:"https://www.php.net/manual/zh/language.generators.syntax.php#control-structures.yield",children:"yield"})," \u7684\u8fd4\u56de\u503c\u3002"]}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u5229\u7528send \u51fd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u4e0e\u534f\u7a0b\u8fdb\u884c\u4ea4\u4e92\uff0c\u5177\u4f53\u5982\u4e0b\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"yield-\u4f5c\u4e3a\u53c2\u6570\u63a5\u53d7\u8005",children:"yield \u4f5c\u4e3a\u53c2\u6570\u63a5\u53d7\u8005"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'<?php\nfunction logger($fileName) {\n    echo "\u8fd9\u4e2a\u8bed\u53e5\u53ea\u4f1a\u6267\u884c\u4e00\u6b21","\\n";\n    while (true) {\n        echo yield . "\\n";\n        //\u51fd\u6570\u6bcf\u6b21\u90fd\u4f1a\u6267\u884c\u8981yield \u6682\u505c\uff0c\u7136\u540e\u8ba9\u51fa\u63a7\u5236\u6743\u3002\n    }\n}\n\n$logger = logger(__DIR__ . \'/log\');\n$logger->send(\'Foo\');  // \u8f93\u51fa "\u8fd9\u4e2a\u8bed\u53e5\u53ea\u4f1a\u6267\u884c\u4e00\u6b21", \u8f93\u51fa Foo \\n;\n$logger->send(\'Bar\');  // \u8f93\u51fa Bar \\n;\n?>\n'})}),"\n",(0,i.jsx)(e.p,{children:"yield \u4f5c\u7528\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u7c7b\u4f3c\u4e8edebug \u65f6\u5019\u7684\u65ad\u70b9\uff0c\u6bcf\u4e00\u6b21\u90fd\u662f\u8fd0\u884c\u5230 yield \u505c\u6b62"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:"\u53ef\u4ee5\u5229\u7528send\u65b9\u6cd5\u7ed9 yield \u4f20\u9012\u6570\u636e"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u90a3\u81ea\u7136\u4f1a\u6709\u4e00\u4e2a\u7591\u95ee\uff0c\u6b64\u5904\u7684 yield \u6709\u6ca1\u6709\u63a5\u53d7\u6570\u636e\u56de\u6765\uff1f\n\u7ecf\u8fc7\u8bd5\u9a8c\uff0c\u53d1\u73b0\u6b64\u5904\u7684yield \u662f\u6ca1\u6709\u8fd4\u56de\u6570\u636e\u7684\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u4e2a\u4f8b\u5b50\u53ef\u4ee5\u770b\u5230yield \u5e76\u6ca1\u6709\u8fd4\u56de\u6570\u636e\uff0c\u662fNULL"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'<?php\nfunction logger($fileName) {\n    echo "\u8fd9\u4e2a\u8bed\u53e5\u53ea\u4f1a\u6267\u884c\u4e00\u6b21","\\n";\n    while (true) {\n        echo yield . "\\n";\n        //\u51fd\u6570\u6bcf\u6b21\u90fd\u4f1a\u6267\u884c\u8981yield \u6682\u505c\uff0c\u7136\u540e\u8ba9\u51fa\u63a7\u5236\u6743\u3002\n    }\n}\n\n$logger = logger(__DIR__ . \'/log\');\n$a = $logger->send(\'Foo\');  // \u8f93\u51fa "\u8fd9\u4e2a\u8bed\u53e5\u53ea\u4f1a\u6267\u884c\u4e00\u6b21", \u8f93\u51fa Foo;\nvar_dump($a); // \u8fd4\u56de NULL , \u8fd9\u91cc\u7684yield \u5e76\u6ca1\u6709\u8fd4\u56de\u4efb\u4f55\u503c\n?>\n'})}),"\n",(0,i.jsx)(e.h3,{id:"yield-\u540c\u65f6\u63a5\u53d7\u548c\u53d1\u9001\u6570\u636e",children:"yield \u540c\u65f6\u63a5\u53d7\u548c\u53d1\u9001\u6570\u636e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\nfunction gen() {\n    $ret = (yield 'yield1');\n    var_dump($ret);\n    $ret = (yield 'yield2');\n    var_dump($ret);\n}\n \n$gen = gen();\nvar_dump($gen->current());    // string(6) \"yield1\"\nvar_dump($gen->send('ret1')); // string(4) \"ret1\"   (the first var_dump in gen)\n                              // string(6) \"yield2\" (the var_dump of the ->send() return value)\nvar_dump($gen->send('ret2')); // string(4) \"ret2\"   (again from within gen)\n                              // NULL               (the return value of ->send())\n?>\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u9010\u53e5\u5206\u6790"}),"\n",(0,i.jsx)(e.p,{children:"$ gen = gen() \u6307\u9488\u6307\u5411\u8fd9\u4e2a\u8fed\u4ee3\u5668"}),"\n",(0,i.jsx)(e.p,{children:"$ gen-> current() \u8fd0\u884c\u5230\u7b2c\u4e00\u4e2ayield \uff0c\u8fd4\u56de yield \u8bed\u53e5\u7684\u503c yield\uff0c\u5e76 \u8f93\u51fa \u7c7b\u578b\u548c\u503c"}),"\n",(0,i.jsx)(e.p,{children:'$ gen ->send("ret1")  \u5f53\u524d\u751f\u6210\u5668\u5728 yield \u8bed\u53e5\uff0c\u4e8e\u662f\u628a "ret1" \u5f53\u505a \uff08yield "yield1"\uff09\u7684\u7ed3\u679c\uff0c\u5e76\u8d4b\u503c\u7ed9 $ret1\u3002\u800c\u4e14\u8fd8\u4f1a\u6267\u884c\u4e00\u4e2a gen->next() \u79fb\u5230\u4e0b\u4e00\u4e2ayield \u5904\uff0c\u8fd4\u56de\u7b2c\u4e8c\u4e2ayield \u8bed\u53e5\u7684\u8fd4\u56de\u503c'}),"\n",(0,i.jsx)(e.p,{children:'$ gen ->send("ret2")  \u5f53\u524d\u751f\u6210\u5668\u5728\u7b2c\u4e8c\u4e2ayield \u8bed\u53e5\uff0c\u628a"ret2" \u5f53\u505a   (yield "yield2") \u7684\u7ed3\u679c\uff0c\u5e76\u8d4b\u503c\u7ed9 $ret2 \u3002\u7ee7\u7eed\u5411\u4e0b\u6267\u884c\uff0c\u6b64\u65f6\u6307\u9488\u4f1a\u79fb\u81f3\u8fed\u4ee3\u5668\u672b\u5c3e\uff0c\u6b64\u65f6\u5df2\u7ecf\u6ca1\u6709yield \uff0c\u6240\u4ee5\u8fd4\u56deNULL'}),"\n",(0,i.jsx)(e.h3,{id:"\u591a\u4efb\u52a1\u5408\u4f5c",children:"\u591a\u4efb\u52a1\u5408\u4f5c"}),"\n",(0,i.jsx)(e.p,{children:"\u4e3a\u4e86\u5e2e\u52a9\u7406\u89e3 \u534f\u7a0b\u548c\u4efb\u52a1\u8c03\u5ea6\u7684\u5173\u673a\uff0cyield \u5728 \u4efb\u52a1\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u4e3b\u52a8\u4e2d\u65ad\u81ea\u8eab\uff0c\u5e76\u628a\u63a7\u5236\u6743\u4ea4\u8fd8\u7ed9\u8c03\u5ea6\u5668\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u91cc\u6211\u4eec\u5148\u9700\u8981\u5b9e\u73b0: \u4efb\u52a1\u3001\u8c03\u5ea6\u5668"}),"\n",(0,i.jsx)(e.h4,{id:"\u4efb\u52a1",children:"\u4efb\u52a1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\nclass Task { //\u5b9e\u73b0\u4e00\u4e2a\u4efb\u52a1\n    protected $taskId; //\u4efb\u52a1ID\n    protected $coroutine;//\u534f\u7a0b\n    protected $sendValue = null;//send \u4f20\u9001\u7684value\n    protected $beforeFirstYield = true;//\u662f\u4e0d\u662f\u7b2c\u4e00\u6b21\u4f20\u9001\n    // \u56e0\u4e3a\u6bcf\u6b21send \u8fd4\u56de\u7684\u503c\uff0c\u90fd\u662f\u5f53\u524dyield \u7684\u4e0b\u4e00\u4e2ayield \u7684\u8fd4\u56de\u503c\uff0c\u8fd9\u5bfc\u81f4\u4e86\u7b2c\u4e00\u4e2ayield \u7684\u8fd4\u56de\u503c\u88ab\u4e22\u5f03\u4e86\u3002\u5bf9\u4e8e\u7b2c\u4e00\u4e2a yield\uff0c\u6211\u4eec\u9700\u8981\u7528current()\u83b7\u53d6\u8fd4\u56de\u503c\uff0c\u4ece\u7b2c\u4e8c\u4e2a\u5f80\u540e\u7528send()\u83b7\u53d6\u8fd4\u56de\u503c\u3002\n    public function __construct($taskId, Generator $coroutine) {//\u534f\u7a0b\u7c7b\u578b\u662f \u8fed\u4ee3\u5668\n        $this->taskId = $taskId;\n        $this->coroutine = $coroutine;\n    }\n \n    public function getTaskId() {\n        return $this->taskId;\n    }\n \n    public function setSendValue($sendValue) {\n        $this->sendValue = $sendValue;\n    }\n \n    public function run() {\n        if ($this->beforeFirstYield) {// \u5982\u679c\u662f\u7b2c\u4e00\u6b21yield\uff0c\u90a3\u4e48\u5c31\u7528current()\u8fd4\u56de\n            $this->beforeFirstYield = false;\n            return $this->coroutine->current();\n        } else {//\u5982\u679c\u4e0d\u662f\u7b2c\u4e00\u4e2ayield\uff0c\u5c31\u7528send\u8bbe\u7f6e\u4e00\u4e2avalue\uff0c\u5e76\u8fd4\u56de\u4e0b\u4e00\u4e2ayield\u7684\u503c\n            $retval = $this->coroutine->send($this->sendValue);\n            $this->sendValue = null;//\u8bbe\u7f6e\u5b8c\u6bd5\u6e05\u7a7avalue\n            return $retval;\n        }\n    }\n \n    public function isFinished() {\n        return !$this->coroutine->valid();// \u5224\u65ad\u8fed\u4ee3\u5668\u662f\u5426\u8fed\u4ee3\u5b8c\u6bd5\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u8fed\u4ee3\u5668",children:"\u8fed\u4ee3\u5668"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\nclass Scheduler {//\u5b9e\u73b0\u4e00\u4e2a\u8c03\u5ea6\u5668\n    protected $maxTaskId = 0; // \u6700\u5927\u4efb\u52a1\n    protected $taskMap = []; // taskId => task\n    protected $taskQueue;// \u4efb\u52a1\u961f\u5217\n \n    public function __construct() {\n        $this->taskQueue = new SplQueue(); // \u5b9e\u4f8b\u5316\u4e00\u4e2a\u961f\u5217\n    }\n \n    public function newTask(Generator $coroutine) {\n        $tid = ++$this->maxTaskId;// \u751f\u6210\u4efb\u52a1id\n        $task = new Task($tid, $coroutine); // \u521b\u5efa\u4efb\u52a1\n        $this->taskMap[$tid] = $task;// \u6807\u8bc6 taskId => task\n        $this->schedule($task);\n        return $tid;\n    }\n \t\t\n    //\u4efb\u52a1\u5165\u961f\n    public function schedule(Task $task) {\n        $this->taskQueue->enqueue($task); \n    }\n    \n    //\u4efb\u52a1\u8fd0\u884c\n    public function run() {\n        while (!$this->taskQueue->isEmpty()) {\n            $task = $this->taskQueue->dequeue();// \u51fa\u961f\n            $task->run(); //\u4efb\u52a1\u8fd0\u884c\n \n            if ($task->isFinished()) { //\u5f53\u524d\u4efb\u52a1\u7ed3\u675f\uff0c\u5220\u9664\n                unset($this->taskMap[$task->getTaskId()]);\n            } else {\n                $this->schedule($task);//\u672a\u5b8c\u6210\u7684\u8bdd\uff0c\u653e\u5165\u961f\u5c3e\u7ee7\u7eed\u6267\u884c\n            }\n        }\n    }\n}\n?>\n\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u7528\u4e00\u4e2a\u4f8b\u5b50\u770b\u770b\u7a0b\u5e8f\u662f\u5426\u6309\u7167\u6211\u4eec\u7684\u671f\u671b\u5728\u8fd0\u884c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'<?php\ninclude ("Task.php"); // \u8f7d\u5165\u5b9a\u4e49\u597d\u7684\u6a21\u5757\ninclude("Scheduler.php");\n\nfunction task1() {// \u7a0b\u5e8f\u8fd0\u884c10\u6b21\n    for ($i = 1; $i <= 10; ++$i) {\n        echo "This is task 1 iteration $i.\\n";\n        yield;\n    }\n}\n\nfunction task2() {// \u7a0b\u5e8f\u8fd0\u884c5\u6b21\n    for ($i = 1; $i <= 5; ++$i) {\n        echo "This is task 2 iteration $i.\\n";\n        yield;\n    }\n}\n\n$scheduler = new Scheduler;\n\n$scheduler->newTask(task1());\n$scheduler->newTask(task2());\n\n$scheduler->run();\n\n\u7ed3\u679c\u5982\u4e0b:\nThis is task 1 iteration 1.\nThis is task 2 iteration 1.\nThis is task 1 iteration 2.\nThis is task 2 iteration 2.\nThis is task 1 iteration 3.\nThis is task 2 iteration 3.\nThis is task 1 iteration 4.\nThis is task 2 iteration 4.\nThis is task 1 iteration 5.\nThis is task 2 iteration 5.\nThis is task 1 iteration 6.\nThis is task 1 iteration 7.\nThis is task 1 iteration 8.\nThis is task 1 iteration 9.\nThis is task 1 iteration 10.\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u53d1\u73b0\u7a0b\u5e8f\u662f\u4ea4\u66ff\u8fd0\u884c\u7684\uff0c\u548c\u6211\u4eec\u7684\u9884\u671f\u662f\u76f8\u540c\u7684\u3002\u56e0\u4e3a\u6211\u4eec\u4f7f\u7528\u4e86\u961f\u5217\u7684\u7ed3\u6784\uff0c\u82e5\u662f\u4e00\u4e2a\u4efb\u52a1\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u540e\u5e76\u6ca1\u6709\u8fd0\u884c\u7ed3\u675f\uff0c\u6211\u4eec\u4f1a\u653e\u5165\u961f\u5c3e\u7ee7\u7eed\u8fd0\u884c\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"\u4e0e\u8c03\u5ea6\u5668\u4e4b\u95f4\u7684\u901a\u4fe1",children:"\u4e0e\u8c03\u5ea6\u5668\u4e4b\u95f4\u7684\u901a\u4fe1"}),"\n",(0,i.jsx)(e.p,{children:"\u6211\u4eec\u518d\u770b\u4e00\u773c\uff0c\u4e0a\u9762\u4f8b\u5b50\u4e2d\u9700\u8981\u8fd0\u884c\u7684\u7a0b\u5e8f"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'function task1() {// \u7a0b\u5e8f\u8fd0\u884c10\u6b21\n    for ($i = 1; $i <= 10; ++$i) {\n        echo "This is task 1 iteration $i.\\n"; // <-- \u82e5\u662f\u8981\u5728\u7528\u8c03\u5ea6\u5668\u4e2d\u7684taskid \u66ff\u4ee3\u6b64\u53e5\u9700\u8981\u600e\u4e48\u505a\u3002\n        yield;\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u4f55\u5b9e\u73b0\uff1a\u4efb\u52a1\u4e0e\u8c03\u5ea6\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u6211\u4eec\u4f7f\u7528\u7684\u662f \u8fdb\u7a0b\u7528\u6765\u548c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u8bdd\u7684\u540c\u6837\u7684\u65b9\u5f0f\u6765\u901a\u4fe1\uff1a\u7cfb\u7edf\u8c03\u7528\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e0d\u80fd\u7b80\u5355\u7684\u628a\u8c03\u5ea6\u5668\u4f5c\u4e3a\u4e00\u4e2a\u53c2\u6570\uff0c\u4f20\u9012\u7ed9\u4efb\u52a1\uff0c\u4e0d\u7136\u5f88\u5371\u9669\u3002\u8fd9\u91cc\u4f5c\u8005\u901a\u8fc7yield\u8868\u8fbe\u5f0f\uff0c\u914d\u5408send \u6765\u4f20\u9012\u4fe1\u606f\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u9996\u5148\u662f\u5bf9\u53ef\u8c03\u7528\u7684\u7cfb\u7edf\u8c03\u7528\u505a\u4e00\u4e2a\u5c01\u88c5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\nclass SystemCall {\n    protected $callback;\n    // \u4f20\u5165\u7684\u503c\u662f \u4e00\u4e2a\u53ef\u8c03\u7528\u7684\u7c7b/\u51fd\u6570\n    public function __construct(callable $callback) {\n        $this->callback = $callback;\n    }\n    // __invoke:\u5f53\u7c7b\u53d1\u751f\u8c03\u7528\u7684\u4f7f\u7528\u4f7f\u7528\n    // \u8fd9\u6837\uff0c\u7c7b\u5728\u4f7f\u7528\u7684\u65f6\u5019\u770b\u4e0a\u53bb\u548c\u4e00\u4e2a\u51fd\u6570\u4e00\u6837\n    // \u4f20\u5165\u7684\u53c2\u6570\u662f \u4efb\u52a1 \u548c \u8c03\u5ea6\u5668\n    // \u4f5c\u7528\u662f\u8fd0\u884c \u521d\u59cb\u5316\u7684\u51fd\u6570/\u7c7b\n    public function __invoke(Task $task, Scheduler $scheduler) {\n        $callback = $this->callback;\n        return $callback($task, $scheduler);\n    }\n}\n?>\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u4e0b\u9762\u6211\u4eec\u9700\u8981\u8fdb\u884c\u6d88\u606f\u901a\u8baf"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'<?php\nfunction task($max) {\n    // \u6211\u4eec\u9700\u8981\u4f20\u5165 $tid \u7684\u503c \u4ece\u8c03\u5ea6\u5668\u4e2d\n    $tid = (yield getTaskId()); // <-- here\'s the syscall!\n    for ($i = 1; $i <= $max; ++$i) {\n        echo "This is task $tid iteration $i.\\n";\n        yield;\n    }\n}\n \n$scheduler = new Scheduler;\n \n$scheduler->newTask(task(10));\n$scheduler->newTask(task(5));\n \n$scheduler->run();\n?>\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u91cc\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u4f20\u5165\u7684getTaskId \u8fdb\u884c\u4fee\u6539"}),"\n",(0,i.jsx)(e.p,{children:"\u4f20\u5165\u7684\u503c\u662f\u6765\u81ea\u4e0e\u8c03\u5ea6\u5668\u548c\u4efb\u52a1\u7684\uff0c\u7ed3\u5408\u4e4b\u524d\u7684\u5c01\u88c5\u7684\u7cfb\u7edf\u8c03\u7528"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\nfunction getTaskId() {\n    return new SystemCall(function(Task $task, Scheduler $scheduler) {\n        $task->setSendValue($task->getTaskId());\n        $scheduler->schedule($task);\n        // \u8fd9\u91cc\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\n        // \u4f5c\u7528\u662f\u7ed9\u4efb\u52a1\u8bbe\u7f6e send \u7684\u503c\uff0csend\u503c\u7684\u5185\u5bb9\u662f taskid\n        // \u628a\u6b64\u4efb\u52a1\u52a0\u5165\u8c03\u5ea6\u5668\u7684\u961f\u5217\u4e2d\u53bb\n    });\n}\n"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd9\u91ccreturn \u7684\u4e0d\u662f\u5982\u51fd\u6570\u540d\u5199\u7684 taskid\uff0c\u800c\u662f\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u6700\u540e\u7a0b\u5e8f\u4e2d\u7684 $tid = (yield getTaskId()); \u53c8\u4f1a\u628a\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u4f20\u5165\u8c03\u5ea6\u5668\u7684\u961f\u5217\u4e2d"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u8fdb\u8fc7\u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u8c03\u5ea6\u5668\u7684\u961f\u5217\u4e2d\u6709\u4e24\u79cd\u7c7b\u578b\u7684\u4efb\u52a1"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"SystemCall\u7c7b\u578b\uff0c\u4f46\u662f\u5b83\u4e5f\u53ef\u4ee5\u548c\u51fd\u6570\u4e00\u6837\u8c03\u7528"}),"\n",(0,i.jsx)(e.li,{children:"Task \u7c7b\u578b\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u7684\u4efb\u52a1\u7c7b\u578b"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u8fd8\u8981\u4fee\u6539\u4e00\u4e0b\u8c03\u5ea6\u5668\u7684run\u65b9\u6cd5\uff08\u5176\u5b9e\u5c31\u662f\u52a0\u5165\u4e00\u6bb5\u5bf9SystemCall \u7684\u5904\u7406\uff09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"public function run() {\n    while (!$this->taskQueue->isEmpty()) {\n        $task = $this->taskQueue->dequeue();\n        $retval = $task->run();\n \t\t\t\t\n       // \u8fd9\u4e00\u6bb5\u662f\u65b0\u52a0\u7684,\u5982\u679c\u51fa\u961f\u7684\u7c7b\u578b\u662f\u7cfb\u7edf\u8c03\u7528\uff0c\u5c31\u5728\u8c03\u5ea6\u5668\u91cc\u9762\u8c03\u7528\u5b83\uff0c\u4f20\u5165\u4efb\u52a1 \u548c \u8c03\u5ea6\u5668\n       // \u8c03\u7528\u7684\u7ed3\u679c\u662f \n       // $task \u4f1a\u8bbe\u7f6e\u4e00\u4e2a Send \u503c\n       // $this(\u8c03\u5ea6\u5668) \u4f1a\u628a\u8fd9\u4e2a $task \u52a0\u5165\u5230\u8c03\u5ea6\u5668\u7684\u672b\u5c3e\n        if ($retval instanceof SystemCall) {\n            $retval($task, $this);\n            continue;\n        }\n      //--------------------------\n \n        if ($task->isFinished()) {\n            unset($this->taskMap[$task->getTaskId()]);\n        } else {\n            $this->schedule($task);\n        }\n    }\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5728xdebug \u7684\u5e2e\u52a9\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u7b2c\u4e00\u6b21 ",(0,i.jsx)(e.code,{children:"$retval = $task->run()"})," \u7684\u8fd4\u56de\u503c\uff0c\u4f1a\u8d70\u5230 Task(line: 24) \u7684",(0,i.jsx)(e.code,{children:"$this->coroutine->current();"})," \u6700\u7ec8\u53d6\u5f97\u7684 ",(0,i.jsx)(e.code,{children:"getTaskId()"})," \u7684\u8fd4\u56de\u503c(\u7c7b\u578b\u4e3a SystemCall)"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191215161137.png",alt:""})}),"\n",(0,i.jsxs)(e.p,{children:["\u7b2c\u4e8c\u6b21\u8d70\u5230",(0,i.jsx)(e.code,{children:"$retval = $task->run()"})," \u7684\u65f6\u5019\uff0c\u6700\u7ec8\u662f\u8fd4\u56detask \u51fd\u6570\u4e2d\u7684",(0,i.jsx)(e.code,{children:"yield();"})," \u6240\u4ee5\u8fd4\u56de\u503c\u662f",(0,i.jsx)(e.code,{children:"null"}),"\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191215162115.png",alt:""})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd0\u884c\u7684\u7ed3\u679c\u5c31\u662f\uff0c\u4e24\u4e2a\u4efb\u52a1\u4ea4\u66ff\u8fd0\u884c\uff0c\u77e5\u9053\u7ed3\u675f\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"This is task 1 iteration 1.\nThis is task 2 iteration 1.\nThis is task 1 iteration 2.\nThis is task 2 iteration 2.\nThis is task 1 iteration 3.\nThis is task 2 iteration 3.\nThis is task 1 iteration 4.\nThis is task 2 iteration 4.\nThis is task 1 iteration 5.\nThis is task 2 iteration 5.\nThis is task 1 iteration 6.\nThis is task 1 iteration 7.\nThis is task 1 iteration 8.\nThis is task 1 iteration 9.\nThis is task 1 iteration 10.\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u534f\u7a0b\u5806\u6808",children:"\u534f\u7a0b\u5806\u6808"}),"\n",(0,i.jsx)(e.p,{children:"\u534f\u7a0b\u5806\u6808\u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u5e94\u7528\uff0c\u5f53\u4f60\u7684\u9879\u76ee\u53d8\u5f97\u8d8a\u6765\u8d8a\u5927\u7684\u65f6\u5019\uff0c\u4f1a\u51fa\u73b0\u534f\u7a0b\u4e2d\u5957\u7528\u53e6\u4e00\u4e2a\u534f\u7a0b\u7684\u60c5\u51b5\u3002\u6211\u4eec\u770b\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\nfunction echoTimes($msg, $max) { // \u5b50\u534f\u7a0b\n    for ($i = 1; $i <= $max; ++$i) {\n        echo \"$msg iteration $i\\n\";\n        yield;\n    }\n}\n \nfunction task() {\n    echoTimes('foo', 10); // \u671f\u5f85\u6253\u537010\u6b21foo\uff0c\u5b9e\u9645\u4e0a\u8fd4\u56de\u7684\u534f\u7a0b\uff0c\u5e76\u6ca1\u6709\u771f\u5b9e\u8fd0\u884c\u8fc7\n    echo \"---\\n\";\n    echoTimes('bar', 5); // \u671f\u5f85\u6253\u53705\u6b21bar\uff0c\u5b9e\u9645\u4e0a\u8fd4\u56de\u7684\u534f\u7a0b\uff0c\u5e76\u6ca1\u6709\u771f\u5b9e\u8fd0\u884c\u8fc7\n    yield; // force it to be a coroutine\n}\n \n$scheduler = new Scheduler;\n$scheduler->newTask(task());\n$scheduler->run();// \u8fd0\u884c\u7ed3\u679c\uff1a ---\\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u6700\u7ec8\u7684\u7ed3\u679c\u53ea\u8fd0\u884c\u4e86",(0,i.jsx)(e.code,{children:'echo "---\\n";'})]}),"\n",(0,i.jsxs)(e.p,{children:["\u539f\u56e0\u4e5f\u5f88\u7b80\u5355\uff0c\u5f53",(0,i.jsx)(e.code,{children:"echoTimes('foo', 10)"})," \u8fd0\u884c\u540e\uff0c\u5b9e\u9645\u4e0a\u8fd4\u56de\u7684\u534f\u7a0b\uff0c\u5e76\u6ca1\u6709\u53c2\u6570\u53bb\u63a5\u53d7\uff0c\u4e5f\u6ca1\u6709\u5bf9\u534f\u7a0b\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u5904\u7406\uff08\u5982 ",(0,i.jsx)(e.code,{children:"$this->current()"})," ",(0,i.jsx)(e.code,{children:"$this->send"})," \uff09\u81ea\u7136\u4e5f\u5c31\u4e0d\u4f1a\u8fd0\u884c\u4e86\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"\u4f46\u662f\u82e5\u662f\u76f4\u63a5\u8c03\u7528 echoTimes \u5b50\u534f\u7a0b\uff0c\u4e5f\u662f\u65e0\u6cd5\u8fd0\u884c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"function task() {\n    yield echoTimes('foo', 10); // \u6dfb\u52a0\u4e86 yield \u8bed\u53e5\n    echo \"---\\n\";\n    yield echoTimes('bar', 5); // \u6dfb\u52a0\u4e86 yield \u8bed\u53e5\n    yield; // force it to be a coroutine\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u56e0\u4e3a\u8fd9\u91cc",(0,i.jsx)(e.code,{children:"yield echoTimes('foo', 10); "}),"\u8fd4\u56de\u7684\u662f\u4e00\u4e2aGenerator \u7c7b\u578b\uff0c\u800c\u5728\u6211\u4eec\u7684Task \u7c7b\u7684run \u65b9\u6cd5\u91cc\u9762\uff0c\u5e76\u6ca1\u6709\u5bf9\u8fd9\u4e00\u7c7b\u578b\u8fdb\u884c\u5904\u7406\u3002\u800c\u4e14\u6211\u4eec\u9700\u8981\u7684\u662f\u8fdb\u5165\u51fd\u6570\u5185\u6267\u884c yield \u8bed\u53e5\u3002\u8fd9\u6837\u6765\u8bf4\uff0c\u6211\u4eec\u539f\u5148\u7684\u65b9\u6cd5\u5c31\u4e0d\u9002\u7528\u4e86\u3002\u5982\u4f55\u89e3\u51b3\uff1f\uff1f"]}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:["\u89e3\u51b3\u7684\u65b9\u6cd5\u5c31\u662f\u4f7f\u7528\u2014\u2014",(0,i.jsx)(e.em,{children:(0,i.jsx)(e.strong,{children:"\u534f\u7a0b\u6808"})})]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u9996\u5148\uff0c\u6211\u4eec\u5bf9\u4f20\u5165\u7684 $coroutine \u88f8\u534f\u7a0b\u4e0a\u5199\u4e00\u4e2a\u5c0f\u5c0f\u7684\u5c01\u88c5\uff0cstackedCoroutine\u5c31\u662f\uff1a",(0,i.jsx)(e.em,{children:(0,i.jsx)(e.strong,{children:"\u201c\u534f\u7a0b\u5806\u6808\u201d"})}),"\u3002 \u56e0\u4e3a\u5b83\u5c06\u7ba1\u7406\u5d4c\u5957\u7684\u534f\u7a0b\u8c03\u7528\u5806\u6808\u3002\u8fd9\u5c06\u4f7f\u5f97\u901a\u8fc7\u751f\u6210\u534f\u7a0b\u6765\u8c03\u7528\u5b50\u534f\u7a0b\u6210\u4e3a\u53ef\u80fd\u3002"]}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u6ce8\u610f: stackedCoroutine \u4e2d\u5305\u542b yield \u8bed\u53e5\uff0c\u6240\u4ee5\u5b83\u4e5f\u662f\u4e00\u4e2a\u534f\u7a0b"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"function stackedCoroutine(Generator $gen)\n{\n    $stack = new SplStack; // \u65b0\u5efa\u4e00\u4e2a\u6808\n\n    // \u4e0d\u65ad\u904d\u5386\u8fd9\u4e2a\u4f20\u8fdb\u6765\u7684\u751f\u6210\u5668\uff0c\u4f5c\u7528\u548c while(True)\u4e00\u6837\n    for (; ;) {\n        // $gen\u53ef\u4ee5\u7406\u89e3\u4e3a\u6307\u5411\u5f53\u524d\u8fd0\u884c\u7684\u534f\u7a0b\u95ed\u5305\u51fd\u6570\uff08\u751f\u6210\u5668\uff09\n        $value = $gen->current(); // \u83b7\u53d6\u4e2d\u65ad\u70b9\uff0c\u4e5f\u5c31\u662fyield\u51fa\u6765\u7684\u503c\n\n        if ($value instanceof Generator) {\n            // \u5982\u679c\u662f\u4e5f\u662f\u4e00\u4e2a\u751f\u6210\u5668\uff0c\u8fd9\u5c31\u662f\u5b50\u534f\u7a0b\u4e86\uff0c\u628a\u5f53\u524d\u8fd0\u884c\u7684\u534f\u7a0b\u5165\u6808\u4fdd\u5b58\n            $stack->push($gen);\n            $gen = $value; // \u628a\u5b50\u534f\u7a0b\u51fd\u6570\u7ed9gen\uff0c\u7ee7\u7eed\u6267\u884c\uff0c\u6ce8\u610f\u63a5\u4e0b\u6765\u5c31\u662f\u6267\u884c\u5b50\u534f\u7a0b\u7684\u6d41\u7a0b\u4e86\n            continue;\n        }\n\n        // \u6211\u4eec\u5bf9\u5b50\u534f\u7a0b\u8fd4\u56de\u7684\u7ed3\u679c\u505a\u4e86\u5c01\u88c5\n        $isReturnValue = $value instanceof CoroutineReturnValue; // \u5b50\u534f\u7a0b\u8fd4\u56de`$value`\u9700\u8981\u4e3b\u534f\u7a0b\u5e2e\u5fd9\u5904\u7406\n        \n        if (!$gen->valid() || $isReturnValue) {// \u534f\u7a0b\u6808\u6ca1\u6709\u6267\u884c\u5b8c \u6216\u8005 \u5b58\u5728\u8fd4\u56de\u503c\n            if ($stack->isEmpty()) {\n                return;\n            }\n            // \u5982\u679c\u662fgen\u5df2\u7ecf\u6267\u884c\u5b8c\u6bd5\uff0c\u6216\u8005\u9047\u5230\u5b50\u534f\u7a0b\u9700\u8981\u8fd4\u56de\u503c\u7ed9\u4e3b\u534f\u7a0b\u53bb\u5904\u7406\n            $gen = $stack->pop(); //\u51fa\u6808\uff0c\u5f97\u5230\u4e4b\u524d\u5165\u6808\u4fdd\u5b58\u7684\u4e3b\u534f\u7a0b\n            $gen->send($isReturnValue ? $value->getValue() : NULL); // \u8c03\u7528\u4e3b\u534f\u7a0b\u5904\u7406\u5b50\u534f\u7a0b\u7684\u8f93\u51fa\u503c\n            continue;\n        }\n\t\t\t\t\n        $gen->send(yield $gen->key() => $value); // \u7ee7\u7eed\u6267\u884c\u5b50\u534f\u7a0b\n    }\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u4eec\u53d1\u73b0\u8fd9\u6bb5\u8bed\u53e5\u4e2d\u4f7f\u7528\u4e86\u5230\u4e86\u4e00\u4e2a\u6211\u4eec\u4e4b\u524d\u6ca1\u6709\u4f7f\u7528\u5230\u7684\u7c7b ",(0,i.jsx)(e.code,{children:"CoroutineReturnValue"})," \u5b83\u7684\u4f5c\u7528\u662f\u63a5\u53d7 yield \u7684\u8fd4\u56de\u503c\uff0c\u8fd9\u4e2a\u7c7b\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u5bf9\u8fd4\u56de\u7684\u503c\uff0c\u505a\u4e86\u4e00\u5c42\u5c01\u88c5\u3002\u5b50\u534f\u7a0b\u7684\u8fd4\u56de\u7684\u7ed3\u679c\u4e5f\u9700\u8981\u4e3b\u534f\u7a0b\u5e2e\u52a9\u5904\u7406\u3002"]}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u5728 $gen->send(yield \u200b$gen->key()=>$value)\uff1b"}),"\n",(0,i.jsx)(e.p,{children:"\u8c03\u7528\u8005\u548c\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u5b50\u534f\u7a0b\u4e4b\u95f4\u626e\u6f14\u7740\u7b80\u5355\u4ee3\u7406\u7684\u89d2\u8272\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"class CoroutineReturnValue {\n    protected $value;\n \n    public function __construct($value) {\n        $this->value = $value;\n    }\n     \n    // \u83b7\u53d6\u80fd\u628a\u5b50\u534f\u7a0b\u7684\u8f93\u51fa\u503c\u7ed9\u4e3b\u534f\u7a0b\uff0c\u4f5c\u4e3a\u4e3b\u534f\u7a0b\u7684send\u53c2\u6570\n    public function getValue() {\n        return $this->value;\n    }\n}\n// \u8fd4\u56de\u7684\u503c\u88ab\u5c01\u88c5\u6210\u4e86\u4e00\u4e2a\u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u7684\u8bdd\u4e5f\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u5b58\u503c\u3002\nfunction retval($value) {\n    return new CoroutineReturnValue($value);\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5b9a\u4e49\u5b8c\u4e86\u534f\u7a0b\u6808\uff0c\u5982\u4f55\u53bb\u4f7f\u7528\u5462\uff1f\u8fd9\u91cc\u9700\u8981\u5c06Task\u4e2d\u7684\u521d\u59cb\u5316\u65b9\u6cd5\u6539\u4e00\u4e0b\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"public function __construct($taskId, Generator $coroutine)\n    {\n        $this->taskId = $taskId;\n        // $this->coroutine = $coroutine;\n        // \u6362\u6210\u8fd9\u4e2a\uff0c\u5b9e\u9645Task->run\u7684\u5c31\u662fstackedCoroutine\u8fd9\u4e2a\u51fd\u6570\uff0c\u4e0d\u662f$coroutine\u4fdd\u5b58\u7684\u95ed\u5305\u51fd\u6570\u4e86\n        $this->coroutine = stackedCoroutine($coroutine); \n    }\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u4e3b\u7a0b\u5e8f\u5982\u4e0b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'<?php\n\ninclude ("Task.php");\ninclude ("Scheduler.php");\ninclude ("stackedCorountine.php");\n\nfunction echoTimes($msg, $max) {\n    for ($i = 1; $i <= $max; ++$i) {\n        echo "$msg iteration $i\\n";\n        yield ;\n    }\n    yield retval("\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u675f"); //\u6211\u4eec\u5728\u8fd9\u91cc\u8ba9\u5b50\u534f\u7a0b\u4f20\u503c\n}\n\nfunction task() {\n    $ret = yield echoTimes(\'foo\', 5); // print foo ten times\n    if ($ret){\n        echo $ret;\n    }\n    echo "---\\n";\n    $ret = (yield echoTimes(\'bar\', 2)); // print bar five times\n    if ($ret){\n        echo $ret;\n    }\n    yield; // force it to be a coroutine\n}\n\n$scheduler = new Scheduler;\n$scheduler->newTask(task());\n$scheduler->run();\n\n\u7ed3\u679c:\nfoo iteration 1\nfoo iteration 2\nfoo iteration 3\nfoo iteration 4\nfoo iteration 5\n\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u675f\n---\nbar iteration 1\nbar iteration 2\n\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u675f\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u4e2a\u7a0b\u5e8f\u771f\u7684\u662f\u4e0d\u5bb9\u6613\u770b\u61c2\uff0c\u6211\u662f\u5728xdebug \u7684\u9010\u6b65\u8c03\u8bd5\u7684\u8fc7\u7a0b\u4e2d\u624d\u770b\u61c2\u4e86\u4e00\u70b9\u3002"}),"\n",(0,i.jsxs)(e.p,{children:["\u89e3\u91ca\u4e0b",(0,i.jsx)(e.code,{children:"$gen->send(yield $gen->key()=>$value)\uff1b"})," \u8fd9\u4e2a\u8bed\u53e5\u4e2dsend \u548c yield \u4ea4\u53c9\uff0c\u800c\u4e14\u7528\u4e86 ",(0,i.jsx)(e.code,{children:"$gen->key => $value"}),"  \u8fd9\u6837\u7684\u7528\u6cd5\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"yield \u6709\u4e09\u79cd\u7528\u6cd5"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53c2\u8003\uff1a"}),(0,i.jsx)(e.a,{href:"https://www.php.net/manual/zh/language.generators.syntax.php#control-structures.yield",children:"php manual: yield"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"yield; // \u76f8\u5f53\u4e8e (yield null);\n$data = (yield $value); // \u5fc5\u987b\u4f7f\u7528\u5706\u62ec\u53f7\u628ayield\u7533\u660e\u5305\u56f4\u8d77\u6765\n$data = (yield $key => $value); //\u8fd4\u56de\u7684\u662f\u952e\u503c\u5bf9\uff0c\u8fed\u4ee3\u7684\u65f6\u5019\u7528 foreach($data as $key => $value)\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u9996\u5148\u6211\u4eec\u627e\u5230 ",(0,i.jsx)(e.code,{children:"(yield $gen->key()=>$value)\uff1b"})," \u8fd4\u56de\u7684\u5730\u65b9"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"public function run() {\n        if ($this->beforeFirstYield) {\n            $this->beforeFirstYield = false;\n            return $this->coroutine->current();  // <-- \u8fd4\u56de\u7684\u662f\u8fd9\u91cc\n        } else {\n            $retval = $this->coroutine->send($this->sendValue); // <-- \u8fd4\u56de\u7684\u662f\u8fd9\u91cc\n            $this->sendValue = null;  \n            return $retval;\n        }\n    }\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u8fd9\u91cc\u4f1a\u8ba9\u4eba\u5f88\u5947\u602a\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd4\u56de\u7684\u662f\u952e\u503c\u5bf9\uff0c\u8fd9\u91cc\u76f4\u63a5\u8c03\u7528current() \u3002\u7ecf\u8fc7\u5b9e\u8df5\u53ef\u77e5 \u6700\u7ec8\u7684\u503c\u662f",(0,i.jsx)(e.code,{children:"$value"})," \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u76f4\u63a5\u628a\u8bed\u53e5\u6539\u6210 ",(0,i.jsx)(e.code,{children:"(yield $value)"})," \u4e5f\u662f\u6b63\u786e\u7684\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u7684\u7b2c\u4e8c\u4e2a\u7591\u95ee\u662f",(0,i.jsx)(e.code,{children:"$gen->send(yield $gen->key()=>$value)\uff1b"})," \u4e2d send \u65b9\u6cd5\u5230\u4f4e\u53d1\u9001\u51fa\u53bb\u4e86\u4ec0\u4e48\u2753"]}),"\n",(0,i.jsx)(e.p,{children:"send  \u65b9\u6cd5\u4e2d\u662f\u4e00\u4e2ayield \u8bed\u53e5\u3002\u90a3\u6211\u4eec\u5c31\u53ef\u4ee5\u627e\u627e\u5728\u8fd9\u4e2a\u534f\u7a0b\u4e2d\u6709\u6ca1\u6709\u5bf9\u5e94\u7684send \u65b9\u6cd5\u5373\u53ef\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191216192955.png",alt:""})}),"\n",(0,i.jsxs)(e.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u627e\u5230\u4e86\u8fd9\u4e2a\u534f\u7a0b\u7684send \u65b9\u6cd5\uff0c\u4f46\u662f",(0,i.jsx)(e.code,{children:"$this->sendValue"})," \u6211\u4eec\u662f\u4e00\u76f4\u90fd\u6ca1\u6709\u8bbe\u7f6e\u8fc7\uff0c\u59cb\u7ec8\u662fnull\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"\u534f\u7a0b\u5806\u6808\u5c0f\u7ed3",children:"\u534f\u7a0b\u5806\u6808\u5c0f\u7ed3"}),"\n",(0,i.jsxs)(e.p,{children:["\u8fd9\u4e2a\u534f\u7a0b\u5806\u6808\u5b9e\u73b0\u8d77\u6765\u6bd4\u8f83\u8d39\u8111\u5b50\uff0c\u7279\u522b\u662f\u4e3b\u534f\u7a0b\u548c\u5b50\u534f\u7a0b\u4e4b\u95f4\u7684\u6c9f\u901a\u65b9\u5f0f\u3002\u53ef\u80fd\u73b0\u5b9e\u60c5\u51b5\u4e0b\u52a8\u624b\u5199\u7684\u60c5\u51b5\u5f88\u5c11\uff08\u6211\u611f\u89c9\u662f\u6846\u67b6\u5df2\u7ecf\u5b9e\u73b0\u5b8c\u6bd5\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7b80\u5355\u7684\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"$ret = (yield readfile());"})," \u8bed\u53e5\u5c31\u53ef\u4ee5\uff09\u3002\u4f46\u662f\u5982\u679c\u80fd\u81ea\u5df1\u5b9e\u73b0\u4e00\u904d\u534f\u7a0b\u5806\u6808\uff0c\u5bf9yield \u7684\u7528\u6cd5\u80af\u5b9a\u638c\u63e1\u7684\u66f4\u597d\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u7bc7\u6559\u7a0b\u53c2\u8003\u4e86\u5f88\u591a\u535a\u5ba2"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://segmentfault.com/a/1190000012457145",children:"PHP7\u4e0b\u7684\u534f\u7a0b\u5b9e\u73b0"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"http://reatang.com/?id=23",children:"\u6211\u662f\u8fd9\u4e48\u7406\u89e3\u534f\u7a0byield\u5f02\u6b65IO\u7684"})}),"\n",(0,i.jsx)(e.p,{children:"TO DO LIST"}),"\n",(0,i.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(e.li,{className:"task-list-item",children:[(0,i.jsx)(e.input,{type:"checkbox",disabled:!0})," yield from"]}),"\n",(0,i.jsxs)(e.li,{className:"task-list-item",children:[(0,i.jsx)(e.input,{type:"checkbox",disabled:!0})," \u6559\u7a0b\u4e2d\u7684 \u975e\u963b\u585eIO \u6848\u4f8b \u4ee3\u7801\u5206\u6790 \u6d4b\u8bd5 \u914d\u5408",(0,i.jsx)(e.a,{href:"http://reatang.com/?id=23",children:"\u6211\u662f\u8fd9\u4e48\u7406\u89e3\u534f\u7a0byield\u5f02\u6b65IO\u7684"})]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u7a0b\u5e8f\u9644\u5f55",children:"\u7a0b\u5e8f\u9644\u5f55"}),"\n",(0,i.jsx)(e.h3,{id:"\u7a0b\u5e8f\u4e00-\u4e0e\u8c03\u5ea6\u5668\u4e4b\u95f4\u7684\u901a\u8baf",children:"\u7a0b\u5e8f\u4e00\uff1a \u4e0e\u8c03\u5ea6\u5668\u4e4b\u95f4\u7684\u901a\u8baf"}),"\n",(0,i.jsx)(e.p,{children:"Index.php"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'<?php\ninclude ("Task.php");\ninclude ("Scheduler.php");\ninclude ("SystemCall.php");\n\nfunction getTaskId() {\n    return new SystemCall(function(Task $task, Scheduler $scheduler) {\n        $task->setSendValue($task->getTaskId());\n        $scheduler->schedule($task);\n    });\n}\n\nfunction task($max) {\n    $tid = (yield getTaskId()); // <-- here\'s the syscall!\n    for ($i = 1; $i <= $max; ++$i) {\n        echo "This is task $tid iteration $i.\\n";\n        yield;\n    }\n}\n\n$scheduler = new Scheduler;\n\n$scheduler->newTask(task(10));\n$scheduler->newTask(task(5));\n\n$scheduler->run();\n?>\n'})}),"\n",(0,i.jsx)(e.p,{children:"Scheduler.php"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\n\n\nclass Scheduler {\n    protected $maxTaskId = 0;\n    protected $taskMap = []; // taskId => task\n    protected $taskQueue;\n\n    public function __construct() {\n        $this->taskQueue = new \\SplQueue();\n    }\n\n    public function newTask(Generator $coroutine) {\n        $tid = ++$this->maxTaskId;\n        $task = new Task($tid, $coroutine);\n        $this->taskMap[$tid] = $task;\n        $this->schedule($task);\n        return $tid;\n    }\n\n    public function schedule(Task $task) {\n        $this->taskQueue->enqueue($task);\n    }\n\n    public function run() {\n        while (!$this->taskQueue->isEmpty()) {\n            $task = $this->taskQueue->dequeue();\n            $retval = $task->run();\n\n            if ($retval instanceof SystemCall) {\n                $retval($task, $this);\n                continue;\n            }\n\n            if ($task->isFinished()) {\n                unset($this->taskMap[$task->getTaskId()]);\n            } else {\n                $this->schedule($task);\n            }\n        }\n    }\n}\n?>\n"})}),"\n",(0,i.jsx)(e.p,{children:"SystemCall.php"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\nclass SystemCall {\n    protected $callback;\n\n    public function __construct(callable $callback) {\n        $this->callback = $callback;\n    }\n\n    public function __invoke(Task $task, Scheduler $scheduler) {\n        $callback = $this->callback;\n        return $callback($task, $scheduler);\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"Task.php"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\nclass Task {\n    protected $taskId;\n    protected $coroutine;\n    protected $sendValue = null;\n    protected $beforeFirstYield = true;\n\n    public function __construct($taskId, Generator $coroutine) {\n        $this->taskId = $taskId;\n        $this->coroutine = $coroutine;\n    }\n\n    public function getTaskId() {\n        return $this->taskId;\n    }\n\n    public function setSendValue($sendValue) {\n        $this->sendValue = $sendValue;\n    }\n\n    public function run() {\n        if ($this->beforeFirstYield) {\n            $this->beforeFirstYield = false;\n            return $this->coroutine->current();\n        } else {\n            $retval = $this->coroutine->send($this->sendValue);\n            $this->sendValue = null;\n            return $retval;\n        }\n    }\n\n    public function isFinished() {\n        return !$this->coroutine->valid();\n    }\n}\n?>\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u7a0b\u5e8f\u4e8c-\u534f\u7a0b\u5806\u6808",children:"\u7a0b\u5e8f\u4e8c\uff1a \u534f\u7a0b\u5806\u6808"}),"\n",(0,i.jsx)(e.p,{children:"index.php"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:'<?php\n\ninclude ("Task.php");\ninclude ("Scheduler.php");\ninclude ("stackedCorountine.php");\n\nfunction echoTimes($msg, $max) {\n    for ($i = 1; $i <= $max; ++$i) {\n        echo "$msg iteration $i\\n";\n        yield ;\n    }\n    yield retval("\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u675f\\n");\n}\n\nfunction task() {\n    $ret = yield echoTimes(\'foo\', 5); // print foo ten times\n    if ($ret){\n        echo $ret;\n    }\n    echo "---\\n";\n    $ret = (yield echoTimes(\'bar\', 2)); // print bar five times\n    if ($ret){\n        echo $ret;\n    }\n    yield; // force it to be a coroutine\n}\n\n$scheduler = new Scheduler;\n$scheduler->newTask(task());\n$scheduler->run();\n'})}),"\n",(0,i.jsx)(e.p,{children:"stackedCoroutine.php"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-php",children:"<?php\n\nfunction stackedCoroutine(Generator $gen) {\n    $stack = new SplStack;\n\n    for (;;) {\n        $value = $gen->current();\n\n        if ($value instanceof Generator) {\n            $stack->push($gen);\n            $gen = $value;\n            continue;\n        }\n\n        $isReturnValue = $value instanceof CoroutineReturnValue;\n        if (!$gen->valid() || $isReturnValue) {\n            if ($stack->isEmpty()) {\n                return;\n            }\n\n            $gen = $stack->pop();\n            $gen->send($isReturnValue ? $value->getValue() : NULL);\n            continue;\n        }\n        \n        $gen->send( (yield $gen->key() => $value));\n    }\n}\n\n\nclass CoroutineReturnValue {\n    protected $value;\n\n    public function __construct($value) {\n        $this->value = $value;\n    }\n\n    // \u83b7\u53d6\u80fd\u628a\u5b50\u534f\u7a0b\u7684\u8f93\u51fa\u503c\u7ed9\u4e3b\u534f\u7a0b\uff0c\u4f5c\u4e3a\u4e3b\u534f\u7a0b\u7684send\u53c2\u6570\n    public function getValue() {\n        return $this->value;\n    }\n}\n\nfunction retval($value) {\n    return new CoroutineReturnValue($value);\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"Task.php  \u548c   Scheduler.php \u4e0d\u53d8"})]})}function u(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>r,x:()=>c});var i=s(96540);const l={},t=i.createContext(l);function r(n){const e=i.useContext(t);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:r(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);